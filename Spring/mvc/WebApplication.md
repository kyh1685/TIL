_김영한 강사님의 스프링 MVC 1편 - 백엔드 웹 개발 핵심 기술 강의를 정리한 내용입니다._

## 웹 서버, 웹 애플리케이션 서버

### 웹 서버(Web Server)
- HTTP 기반으로 동작
- 정적 리소스 제공, 기타 부가기능
- 정적(파일) HTML, CSS, JS, 이미지, 영상
예) NGINX, APACHE

### 웹 애플리케이션 서버(WAS - Web Application Server)
- HTTP 기반으로 동작
- 웹 서버 기능 + α
- **프로그램 코드를 실행해서 애플리케이션 로직 수행**
  - 동적 HTML, HTTP API(JSON)
  - 서블릿, JSP, 스프링 MVC
예) 톰캣(Tomcat) Jetty, Undertow

**🤔 웹 서버와 웹 애플리케이션 서버의 차이점은?**
- 웹 서버는 정적 리소스(파일), WAS는 애플리케이션 로직 수행
- 하지만 둘의 경계는 모호함...
  - 웹 서버도 프로그램을 실행하는 기능을 포함하기도 함
  - 웹 애플리케이션 서버도 웹 서버의 기능을 제공함
- **자바는 서블릿 컨테이너 기능을 제공하면 WAS**
  - 서블릿 없이 자바코드를 실행하는 서버 프레임워크도 있음
- **WAS는 애플리케이션 코드를 실행하는데 더 특화**

### 웹 시스템 구성 - WAS, DB
WAS는 정적 리소스, 애플리케이션 로직 모두 가능함
👉 **WAS, DB 만으로 시스템 구성 가능**

🚨 **BUT! WAS가 너무 많은 역할을 담당하면 서버가 과부하 될 수도 있음**
🤦‍♀️ 가장 비싼 애플리케이션 로직이 정적 리소스 때문에 수행이 어려울 수 있음
🤦‍♀️ WAS 장애시 오류 화면도 노출 불가능

**📌 결국 **
- 웹 서버는 정적 리소스 처리 
- WAS는 중요한 애플리케이션 로직 처리
![](https://images.velog.io/images/3hee_11/post/559a43b6-76ab-49e4-9eaf-82fb3a3e83ea/image.png)

#### 효율적인 리소스 관리
- 정적 리소스가 많이 사용되면 Web 서버 증설
- 애플리케이션 리소스가 많이 사용되면 WAS 증설

## 서블릿

### 서블릿 특징
<img src="https://images.velog.io/images/3hee_11/post/b20eb83c-9c01-47e0-b696-49e437a7c63e/image.png">

- urlPatterns(/hello)의 URL이 호출되면 서블릿 코드가 실행된다.
- HTTP 요청, 응답 정보를 각각 HttpServletRequest, HttpServletResponse를 통해 편리하게 사용할 수 있다. 
![](https://images.velog.io/images/3hee_11/post/ade8c437-da14-44bf-8fc6-30aca11b7ce7/image.png)

### HTTP 요청, 응답 흐름

#### HTTP 요청시
- WAS는 Request, Response 객체를 새로 만들어서 서블릿 객체 호출
- 개발자는 Request 객체에서 HTTP 요청 정보를 꺼내서 사용하고.  Response 객체에 HTTP 응답 정보를 입력
- WAS는 Response 객체에 담겨있는 내용으로 HTTP 응답 정보를 생성

### 서블릿 컨테이너
- 서블릿을 지원하는 WAS를 서블릿 컨테이너라고 함
- 서블릿 객체를 생성, 초기화, 호출, 종료하는 생명주기 관리
- 서블릿 객체는 싱글톤으로 관리
  - 최초 로딩 시점에 서블릿 객체를 미리 만들어두고 재활용
  - 모든 고객 요청은 동일한 서블릿 객체 인스턴스에 접근
  - 서블릿 컨테이너 종료시 함께 종료
- JSP도 서블릿으로 변환 되어서 사용
- 동시 요청을 위한 멀티 쓰레드 처리 지원

## 동시 요청 - 멀티 쓰레드

### 쓰레드
- 애플리케이션 코드를 하나씩 순차적으로 실행하는 것이 쓰레드
- 자바 메인 메서드를 처음 실행하면 main이라는 이름의 쓰레드가 실행
- 쓰레드가 없다면 자바 애플리케이션 실행이 불가능
- 동시 처리가 필요하면 쓰레드를 추가로 생성해야 함

**💡 클라이언트가 요청을 하면 쓰레드가 할당되고 서블릿 객체를 호출한다.**

#### 🤔 요청마다 쓰레드를 생성한다면?
**장점** 
- 동시 요청을 처리 가능
- 리소스(CPU, 메모리)가 허용할 때 까지 처리가능
- 하나의 쓰레드가 지연 되어도 나머지 쓰레드는 정상 동작
  
**단점**
- 쓰레드는 생성 비용은 매우 비쌈
  - 고객의 요청이 올 때 마다 쓰레드를 생성하면 응답 속도가 늦어짐
- 쓰레드는 컨텍스트 스위칭 비용이 발생
- 쓰레드 생성에 제한이 없다.
  - 요청이 너무 많으면 CPU, 메모리 임계점을 넘어서 서버가 죽을 수 있음
  
### 스레드풀
**특징**
- 필요한 쓰레드를 쓰레드 풀에 보관하고 관리한다.
- 쓰레드 풀에 생성 가능한 쓰레드의 최대치를 관리한다(톰캣은 최대 200개 기본 설정)

**사용**
- 쓰레드가 필요하면 이미 생성되어 있는 쓰레드를 꺼내서 사용한다.
- 사용을 종료하면 쓰레드 풀에 해당 쓰레드를 반납한다.
- 쓰레드가 모두 사용중이면 기다리는 요청을 거절하거나 대기하게 설정할 수 있다.

**장점**
- 쓰레드가 미리 생성되어 있으므로, 쓰레드를 생성하고 종료하는 비용(CPU)이 절약되고, 응답 시간이 빠르다.
- 생성 가능한 쓰레드의 최대치가 있으므로 너무 많은 요청이 들어와도 기존 요청은 안전하게 처리할 수 있다.

**🍯 실무 팁**
- **WAS의 주요 튜닝 포인트는 최대 쓰레드(max thread) 수**
- 너무 낮게 설정하면 동시 요청이 많을 때 서버 리소스는 여유롭지만 클라이언트가 금방 응답을 지연하게 됨
- 너무 높게 설정하면 동시 요청이 많을 때 CPU, 메모리 리소스 임계점 초과로 서버가 금방 다운되게 됨
- 장애 발생시 원인이 클라우드면 서버부터 늘린 후 튜닝하고, 아니면 열심히 튜닝

**🤔 쓰레드풀의 적정 숫자는 얼마인가?**
- 애플리케이션 로직의 복잡도, CPU, 메모리, IO 리소스 상황에 따라 모두 다름
- 최대한 실제 서비스와 유사하게 성능 테스트 해봐야 함
  - 툴 : 아파치 ab, 제이미터, nGrinder
  
## HTML, HTTP API, CSR, SSR

### 정적 리소스
- 고정된 HTML 파일, CSS, JS, 이미지, 영상 등을 제공하며 주로 웹 브라우저

### HTML 페이지
- 동적으로 필요한 HTML 파일을 생성해서 전달하며 웹 브라우저는 HTML을 해석

### HTTP API
- HTML이 아니라 **데이터를 전달**하며 주로 JSON 형식 사용
- 다양한 시스템에서 호출
- 앱, 웹 클라이언트, 서버 to 서버

### 서버사이드 렌더링, 클라이언트 사이드 렌더링

#### SSR - 서버 사이드 렌더링
- **HTML 최종 결과를 서버에서 만들어서** 웹 브라우저에 전달
- 주로 정적인 화면에 사용
- 관련기술 : JSP, 타임리프

#### CSR - 클라이언트 사이드 렌더링
- **HTML 결과를 자바스크립트를 사용해 웹 브라우저에서 동적으로 생성**해서 적용
- 주로 동적인 화면에 사용하며 웹을 마치 앱처럼 필요한 부분만 변경할 수 있음
예) 구글 지도, Gmail, 구글 캘린더
- 관련기술 : React, Vue.js
